#!/bin/bash
#
# symlinks - Create symbolic links for dotfiles configuration

echo 'Creating symlinks for dotfiles...'
echo '================================='

# Function to generate gitconfig from template
generate_gitconfig() {
    echo 'Generating git configuration from template...'
    
    # Load environment variables if .env exists
    if [ -f $HOME/.dotfiles/.env ]; then
        set -a
        source $HOME/.dotfiles/.env
        set +a
    fi
    
    # Use envsubst to replace environment variables in template
    envsubst < $HOME/.dotfiles/.gitconfig.template > $HOME/.dotfiles/.gitconfig.local
}

# Generate and link git configuration
generate_gitconfig
echo 'Linking git configuration...'
rm -f $HOME/.gitconfig
ln -s $HOME/.dotfiles/.gitconfig.local $HOME/.gitconfig

# Global gitignore
echo 'Linking global gitignore...'
rm -f $HOME/.global-gitignore
ln -s $HOME/.dotfiles/shell/.global-gitignore $HOME/.global-gitignore

# Zsh configuration  
echo 'Linking zsh configuration...'
rm -f $HOME/.zshrc
ln -s $HOME/.dotfiles/shell/.zshrc $HOME/.zshrc

# Vim configuration
echo 'Linking vim configuration...'
rm -f $HOME/.vimrc
ln -s $HOME/.dotfiles/vim/.vimrc $HOME/.vimrc

# Neovim configuration
echo 'Linking neovim configuration...'
mkdir -p $HOME/.config
rm -rf $HOME/.config/nvim
ln -s $HOME/.dotfiles/nvim $HOME/.config/nvim

# Kitty terminal configuration
echo 'Linking kitty configuration...'
mkdir -p $HOME/.config/kitty
rm -f $HOME/.config/kitty/kitty.conf
ln -s $HOME/.dotfiles/kitty/kitty.conf $HOME/.config/kitty/kitty.conf

# GitHub CLI configuration
echo 'Linking GitHub CLI configuration...'
mkdir -p $HOME/.config
rm -rf $HOME/.config/gh
ln -s $HOME/.dotfiles/gh $HOME/.config/gh

# Claude configuration
echo 'Linking Claude configuration...'
rm -rf $HOME/.claude
ln -s $HOME/.dotfiles/claude $HOME/.claude

# Tmux configuration
echo 'Linking tmux configuration...'
rm -f $HOME/.tmux.conf
ln -s $HOME/.dotfiles/.tmux.conf $HOME/.tmux.conf

echo 'All symlinks created successfully!'