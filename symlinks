#!/bin/bash
#
# symlinks - Create symbolic links for dotfiles configuration

echo 'Creating symlinks for dotfiles...'
echo '================================='

# Function to generate gitconfig from template
generate_gitconfig() {
    echo 'Generating git configuration from template...'

    # Load environment variables if .env exists
    if [ -f $HOME/.dotfiles/.env ]; then
        set -a
        source $HOME/.dotfiles/.env
        set +a
    fi

    # Use envsubst to replace environment variables in template
    envsubst < $HOME/.dotfiles/git/.gitconfig.template > $HOME/.dotfiles/.gitconfig.local
}

# Generate and link git configuration
generate_gitconfig
echo 'Linking git configuration...'
rm -f $HOME/.gitconfig
ln -s $HOME/.dotfiles/.gitconfig.local $HOME/.gitconfig

# Global gitignore
echo 'Linking global gitignore...'
rm -f $HOME/.gitignore_global
ln -s $HOME/.dotfiles/git/.gitignore_global $HOME/.gitignore_global

# Zsh configuration
echo 'Linking zsh configuration...'
rm -f $HOME/.zshrc
ln -s $HOME/.dotfiles/shell/.zshrc $HOME/.zshrc

# Vim configuration
echo 'Linking vim configuration...'
rm -f $HOME/.vimrc
ln -s $HOME/.dotfiles/vim/.vimrc $HOME/.vimrc

# Neovim configuration
echo 'Linking neovim configuration...'
mkdir -p $HOME/.config
rm -rf $HOME/.config/nvim
ln -s $HOME/.dotfiles/nvim $HOME/.config/nvim

# Kitty terminal configuration
echo 'Linking kitty configuration...'
mkdir -p $HOME/.config
rm -rf $HOME/.config/kitty
ln -s $HOME/.dotfiles/kitty $HOME/.config/kitty

# GitHub CLI configuration
echo 'Linking GitHub CLI configuration...'
mkdir -p $HOME/.config
rm -rf $HOME/.config/gh
ln -s $HOME/.dotfiles/gh $HOME/.config/gh

# Claude configuration
echo 'Linking Claude configuration...'
rm -rf $HOME/.claude
ln -s $HOME/.dotfiles/claude $HOME/.claude

# Opencode configuration
echo 'Linking Opencode configuration...'
rm -rf $HOME/.config/opencode
ln -s $HOME/.dotfiles/opencode $HOME/.config/opencode

# Shared skills (for Claude and Opencode)
echo 'Linking shared skills...'
rm -rf $HOME/.dotfiles/claude/skills
ln -s $HOME/.dotfiles/skills $HOME/.dotfiles/claude/skills
rm -rf $HOME/.dotfiles/opencode/skills
ln -s $HOME/.dotfiles/skills $HOME/.dotfiles/opencode/skills

# Tmux configuration
echo 'Linking tmux configuration...'
rm -f $HOME/.tmux.conf
ln -s $HOME/.dotfiles/.tmux.conf $HOME/.tmux.conf

# Lazygit configuration
echo 'Linking lazygit configuration...'
LAZYGIT_CONFIG_DIR=$(lazygit -cd)
rm -f "$LAZYGIT_CONFIG_DIR/config.yml"
ln -s $HOME/.dotfiles/lazygit/config.yml "$LAZYGIT_CONFIG_DIR/config.yml"

# Rector configuration
echo 'Linking rector configuration...'
rm -f $HOME/.rector/rector.php
mkdir -p $HOME/.rector
ln -s $HOME/.dotfiles/rector.php $HOME/.rector/rector.php

# SSH configuration
echo 'Linking SSH configuration...'
mkdir -p $HOME/.ssh
rm -f $HOME/.ssh/config
ln -s $HOME/.dotfiles/ssh/config $HOME/.ssh/config


echo 'All symlinks created successfully!'
